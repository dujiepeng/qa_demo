# Changelog
 
## [1.32.0+33] - 2026-01-14

### 修改内容
- **[优化]** 测试页面图标更新:
    - 为“单聊”、“群聊”、“聊天室”匹配了更具语义化的 Material Design 图标，提升了界面可读性。
- **[版本]** 迭代项目版本号至 `1.32.0+33`。
 
## [1.31.0+32] - 2026-01-14

### 修改内容
- **[重构]** 测试页面网格样式优化:
    - 解决了网格项未完全铺满容器的问题，现在每个单元格均能实现 100% 填充。
    - 优化了网格顶部对齐逻辑，缩减了与 `AppBar` 的过度间距。
- **[版本]** 迭代项目版本号至 `1.31.0+32`。
 
## [1.30.0+31] - 2026-01-14

### 修改内容
- **[修复]** 个人中心布局重叠:
    - 为 `MePage` 的 `ListView` 增加了顶部内边距，修正了在开启全屏背景扩展时列表内容与 `AppBar` 发生重叠的问题。
- **[版本]** 迭代项目版本号至 `1.30.0+31`。
 
## [1.29.0+30] - 2026-01-14

### 修改内容
- **[修复]** 测试页面网格布局异常:
    - 修正了网格项的宽高比 (`childAspectRatio`) 为 `1.0`，解决了在部分设备上出现的纵向拉伸问题。
    - 优化了网格项角标的定位坐标，确保角标完整显示且位置更自然。
- **[版本]** 迭代项目版本号至 `1.29.0+30`。
 
## [1.28.0+29] - 2026-01-14

### 修改内容
- **[样式]** 测试页面 UI 优化:
    - 调整 `TestPage` 网格列表的行列间距及页面内边距从 `15` 缩减至 `10`，使界面布局更紧凑。
- **[版本]** 迭代项目版本号至 `1.28.0+29`。
 
## [1.27.0+28] - 2026-01-14

### 修改内容
- **[优化]** 测试页面功能增强:
    - 在 `TestPage` 中实现了 3 列功能网格列表。
    - 网格项支持显示自定义图标，若未提供则自动使用标题首字作为占位。
    - 增加了右上角红色数字角标支持。
    - 适配了深色/浅色模式下的玻璃拟态视觉风格。
- **[版本]** 迭代项目版本号至 `1.27.0+28`。
 
## [1.26.0+27] - 2026-01-14

### 修改内容
- **[修复]** 主题切换响应失效问题:
    - 修正了 `HomePage` 中颜色状态变量的解析作用域，将其移入 `AnimatedBuilder` 监听闭包内，确保 AppBar 和 TabBar 实时同步主题色。
    - 在 `MePage` 和 `TestPage` 中启用了 `extendBodyBehindAppBar`，确保透明 AppBar 下方的渐变背景在切换主题时能正确展示。
- **[版本]** 迭代项目版本号至 `1.26.0+27`。
 
## [1.25.0+26] - 2026-01-14

### 修改内容
- **[新组件]** 创建 `TestPage`:
    - 增加了一个基础的测试页面组件 `TestPage`。
    - 该页面提供了居中的图标与文字提示，具备良好的主题适配。
- **[集成]** 首页测试模式优化:
    - 在 `HomePage` 的测试模式下，使用正式的 `TestPage` 替换了之前的临时占位文字。
- **[版本]** 迭代项目版本号至 `1.25.0+26`。
 
## [1.24.0+25] - 2026-01-14

### 修改内容
- **[新功能]** 测试模式 (Test Mode):
    - 在“我” -> “高级设置”中增加了“测试模式”切换开关。
    - 开启后，底部导航栏将仅保留“测试”和“我”两个 Tab，方便快速测试。
    - 实现了该模式的持久化存储，应用重启后依然生效。
- **[重构]** 状态管理优化:
    - 将 `AppSettings` 重构为 `ChangeNotifier`。
    - 全局 UI（如 `HomePage`）现在能即时响应设置变化（包括测试模式和深色模式的切换）。
- **[版本]** 迭代项目版本号至 `1.24.0+25`。
 
## [1.23.0+24] - 2026-01-14

### 修改内容
- **[重命名]** 设置页重构为“我” (Me):
    - 将 `SettingsTabPage` 全面重命名为 `MeTabPage`。
    - 文件名由 `settings_tab_page.dart` 修改为 `me_tab_page.dart`。
    - 更新 `HomePage` 中的底部导航栏：标签由“设置”改为“我”，图标由 `settings` 改为 `person`。
    - 页面内部标题由“设置”同步更新为“我”。
- **[版本]** 迭代项目版本号至 `1.23.0+24`。
 
## [1.22.0+23] - 2026-01-14

### 修改内容
- **[重构]** 简化申请列表数据结构:
    - 将 `ChatEventManager` 中的 `friendInvitations` 由 `ValueNotifier` 改为普通 `List`。
    - 优化了增删逻辑，减少了不必要的外部监听。
    - 补全了之前丢失的自动清理逻辑，确保申请被处理后列表实时同步。
    - 继续通过 `friendRequestCount` (ValueNotifier) 驱动 UI 上的数量 Badge 刷新。
- **[版本]** 迭代项目版本号至 `1.22.0+23`。
 
## [1.21.0+22] - 2026-01-14

### 修改内容
- **[新增]** 好友申请入口集成:
    - 在 `ContactsPage` 好友列表顶部新增固定的“好友申请”入口。
    - 集成 `ValueListenableBuilder` 实时监听 `ChatEventManager.friendRequestCount`。
    - 实现了数量 Badge 逻辑：仅在申请数非零时显示红色数字提醒，确保用户能即时感知好友申请。
- **[优化]** 好友列表空状态逻辑: 重构了列表展示逻辑，确保护顶部入口在无好友时依然常驻显示并支持下拉刷新。
- **[版本]** 迭代项目版本号至 `1.21.0+22`。
 
## [1.20.0+21] - 2026-01-14

### 修改内容
- **[优化]** 好友申请列表自动清理机制:
    - 在 `ChatEventManager` 中增加了 `_removeInvitation` 私有方法。
    - 在 `onContactAdded`、`onFriendRequestAccepted` 和 `onFriendRequestDeclined` 事件发生时，会自动从 `friendInvitations` 列表中移除对应用户的申请记录。
    - 确保 `friendRequestCount` 计数器与列表长度实时保持同步，解决了申请被处理后列表冗余的问题。
- **[版本]** 迭代项目版本号至 `1.20.0+21`。
 
## [1.19.0+20] - 2026-01-14

### 修改内容
- **[新增]** 完整好友申请列表记录:
    - 在 `ChatEventManager` 中引入了 `friendInvitations` 通知器 (`ValueNotifier<List<Map<String, String>>>`)。
    - 在收到好友申请时，不仅更新计数，还会记录对应的 `userId`、`reason` 以及收到的时间。
    - 外部组件可实时监听列表变化以展示详细的申请历史。
- **[版本]** 迭代项目版本号至 `1.19.0+20`。
 
## [1.18.0+19] - 2026-01-14

### 修改内容
- **[新增]** 好友申请实时统计:
    - 在 `ChatEventManager` 中引入了 `ValueNotifier<int>` 类型的 `friendRequestCount`。
    - 在收到好友申请 (`onContactInvited`) 时自动增加计数值，支持外部 UI 使用 `ValueListenableBuilder` 进行实时响应。
- **[版本]** 迭代项目版本号至 `1.18.0+19`。
 
## [1.17.0+18] - 2026-01-14

### 修改内容
- **[新增]** 登录状态持久化:
    - 在 `AppSettings` 中增加了 `isLoggedIn` 的本地存储逻辑。
    - 实现了 `loadSettings` 时自动恢复登录状态，并确保 `main.dart` 根据此状态决定初始路由。
    - 在 `LoginPage` 登录成功后以及 `SettingsTabPage` 退出登录后自动触发状态持久化，解决了应用重启后登录状态丢失的问题。
- **[版本]** 迭代项目版本号至 `1.17.0+18`。

### 修改人
- Antigravity

### 修改版本
- 1.17.0+18

## [1.11.0+10] - 2026-01-14

### 修改内容
- **[修复]** 好友列表类型不匹配: 
    - 修复了 `ContactsPage` 中 `_contacts` 列表类型从 `List<String>` 改为 `List<EMContact>` 导致的 UI 冲突。
    - 确保好友列表正确提取 `EMContact.userId` 进行展示。
- **[新增]** 控制台日志增强: 在 `ContactsPage` 的错误处理逻辑中增加了 `debugPrint`，确保异常信息能实时输出到开发者控制台。
- **[修改]** 登录状态存储机制优化: 将 `isLoggedIn` 状态改为仅内存存储，确保 Hot Reload 时状态保持，而应用重启或 Restart 后需重新登录。
- **[修复]** 路由跳转异常: 在 `main.dart` 中补充注册了 `/settings` 路由，解决了无法从登录页或设置 Tab 跳转到服务器配置页的问题。
- **[新增]** 全局事件监听器: 
    - 引入了 `ChatEventManager` 全局管理类。
    - 在登录成功后自动启动好友事件监听器，支持记录好友申请及状态变更日志。
- **[修改]** 退出逻辑优化: 
    - 将首页设置 Tab 和高级设置页中的“退出应用”按钮改为“退出登录”。
    - 按钮点击后将调用环信同步退出逻辑 (`EMClient.logout`) 并返回登录界面。
    - 仅在高级配置信息变更时保留原有的应用退出逻辑，以保证配置生效。
- **[重构]** 首页模块化拆分: 
    - 将首页五个 Tab 子页面（会话、好友、群组、聊天室、设置）分别提取到独立的文件中。
    - 大幅精简 `home_page.dart` 代码，使其仅作为容器存在。
    - 统一了各子页面的命名规范与导出逻辑。
- **[优化]** 好友列表加载体验: 
    - 确保好友列表在空状态下也能通过物理滚动支持下拉刷新。
    - 增强了联系人拉取的调试日志输出。
- **[精简]** 代码清理: 
    - 移除了 `main.dart` 中对 `login_page.dart` 的重复导入。
    - 优化了好友页面的数据处理流程，直接操作 SDK 返回的对象。

### 修改人
- Antigravity

### 修改版本
- 1.11.0+10


### 修改内容
- **[新增]** 明暗双主题系统: 
    - 实现明亮/深色两套配色方案。
    - 主题切换支持实时 UI 刷新与本地持久化。
- **[修复]** 代码引用错误: 修复了 `AppColors` 重构后导致的 `login_page.dart` 编译报错。
- **[精简]** 配置页面瘦身: 
    - 移除已不再需要的 `SettingsPage` 以及所有连接配置相关的逻辑。
    - 将偏好设置面板精简整合至首页。

### 修改人
- Antigravity

### 修改版本
- 1.9.0+10

## [1.8.0+9] - 2026-01-14

### 修改内容
- **[新增]** 自动登录功能: 
    - 在 `AppSettings` 中增加 `isLoggedIn` 字段。
    - `main.dart` 启动时动态分发 `initialRoute`。
    - `LoginPage` 登录成功后自动触发状态持久化。

### 修改人
- Antigravity

### 修改版本
- 1.8.0+9

## [1.7.0+8] - 2026-01-14

### 修改内容
- **[新增]** 首页子页面 AppBar: 为会话、好友等所有 Tab 页添加了统一风格的导航栏。
- **[新增]** 主题持久化: 在设置 Tab 增加深色模式开关，状态自动保存至本地。
- **[新增]** 彻底退出入口: 在设置 Tab 底部增加“彻底退出应用”按钮，调用 `exit(0)` 强制关闭。
- **[优化]** 设置功能整合: 在首页设置 Tab 增加了通往高级配置（AppKey/Server）的跳转入口。

### 修改人
- Antigravity

### 修改版本
- 1.7.0+8

## [1.6.0+7] - 2026-01-14

### 修改内容
- **[新增]** 首页底部导航栏: 
    - 集成 `BottomNavigationBar` 实现五个主模块切换。
    - 预留会话、好友、群组、聊天室及设置五个功能入口。
    - 设计美观的 Tab 占位页面，支持流畅的 `IndexedStack` 切换。

### 修改人
- Antigravity

### 修改版本
- 1.6.0+7

## [1.5.0+6] - 2026-01-14

### 修改内容
- **[修复]** 设置变更检测失效问题: 
    - 引入 `AppSettings` 快照机制，确保对比逻辑不受内存中间态影响。
    - 修复 `SettingsPage` 保存逻辑，确保 Switch 状态变更能触发提醒。
- **[增强]** 强制重启逻辑: 确认保存后使用 `exit(0)` 代替温和退出，确保应用彻底关闭。

### 修改人
- Antigravity

### 修改版本
- 1.5.0+6

## [1.4.0+5] - 2026-01-14

### 修改内容
- **[新增]** 设置变更安全控制: 
    - 实现 `AppSettings.hasChanged` 配置对比逻辑。
    - 在 `SettingsPage` 保存时增加“重启提醒”弹窗。
    - 引入 `SystemNavigator.pop()` 确保配置变更后应用彻底退出，引导用户重新启动。
- **[优化]** 代码健壮性: 修复了重构过程中遗漏的导入项。

### 修改人
- Antigravity

### 修改版本
- 1.4.0+5

## [1.3.0+4] - 2026-01-14

### 修改内容
- **[重构]** 首页解耦: 
    - 创建 `lib/pages/home_page.dart`。
    - 将 `MyHomePage` 逻辑完整迁移并将主类名调整为 `HomePage`。
    - 精简 `main.dart`，使其回归“应用引导与配置”的核心职责。

### 修改人
- Antigravity

### 修改版本
- 1.3.0+4

## [1.2.0+3] - 2026-01-14

### 修改内容
- **[新增]** 配置持久化存储: 
    - 集成 `shared_preferences` 插件。
    - 实现 AppKey、IM Server、IM Port、Rest Server 及开关状态的本地保存与读取。
    - 优化启动流程，确保 App 启动时自动加载历史配置。
- **[优化]** 设置页交互: 支持点击 Check 图标保存并自动退出。

### 修改人
- Antigravity

### 修改版本
- 1.2.0+3

## [1.1.0+2] - 2026-01-14

### 修改内容
- **[新增]** 登录页面 `LoginPage`: 
    - 采用现代渐变 UI 设计，提升视觉体验。
    - 支持 `UID` 和 `Password` 表单输入。
    - 集成模拟登录逻辑及跳转功能。
    - 包含第三方登录图标示意。
- **[新增]** 设置页面 `SettingsPage`: 
    - 预留空白设置页面供后续开发。
- **[新增]** 设计系统 `AppColors`: 
    - 定义了项目的统一色值方案。
- **[修改]** 路由重构 `main.dart`: 
    - 将应用启动首屏从首页改为登录页。
    - 整合了登录、主页、设置之间的导航路由。
- **[优化]** 启用 Material 3 设计规范。

### 修改人
- Antigravity

### 修改版本
- 1.1.0+2
